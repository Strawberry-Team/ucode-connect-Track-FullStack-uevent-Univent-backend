app = "univent"

primary_region = "fra"

kill_signal = "SIGTERM"
kill_timeout = 120

[build]
  builder = "paketobuildpacks/builder:base"
  buildpacks = ["gcr.io/paketo-buildpacks/nodejs"]
  [build.args]
    NODE_ENV = "production"

[env]
  APP_DOMAIN = "univent.com"
  APP_FRONTEND_HOST = "univent-platform.vercel.app"
  APP_FRONTEND_PORT = "443"
  APP_FRONTEND_PROTOCOL = "https"
  APP_HOST = "univent-platform.koyeb.app"
  APP_NAME = "Univent"
  APP_NODE_ENV = "production"
  APP_PORT = "8080"
  APP_PROTOCOL = "https"
  APP_SUPPORT_EMAIL = "univent.platform@gmail.com"
  APP_THEME_ID = "1"
  DB_APP_DATABASE = "univent"
  DB_APP_HOST = "gateway01.eu-central-1.prod.aws.tidbcloud.com"
  DB_APP_PORT = "4000"
  DB_APP_USER = "3r594CwdF1zwu1z.root"
  DB_ROOT_HOST = "gateway01.eu-central-1.prod.aws.tidbcloud.com"
  DB_ROOT_PORT = "4000"
  DB_ROOT_USER = "3r594CwdF1zwu1z.root"
  ETHEREAL_HOST = "smtp.ethereal.email"
  ETHEREAL_PORT = "587"
  ETHEREAL_USER = "ricky43@ethereal.email"
  GOOGLE_GMAIL_USER = "univent.platform@gmail.com"
  SHADOW_DB_APP_DATABASE = "univent_shadow"
  STRIPE_PUBLISHABLE_KEY = "pk_test_51RJEyBIYcs5PmiXTcEHK1fpmYALG1WfWudU4b2Ijs1rBCpzAq8QGrcvrxz3NBePzEp1JG8EySrO129rALgHgyzYY00gEEtZJ1P"
  UNSPLASH_ACCESS_KEY = "0L7BNquOQJQBdeANdejsAcCdl7fQ2VDjGZS3v9wkNuQ"

[http_service]
  internal_port = 8080
  force_https = true
  auto_stop_machines = "stop"
  auto_start_machines = true
  min_machines_running = 0
  processes = ["app"]
  [http_service.concurrency]
    type = "requests"
    soft_limit = 50
    hard_limit = 75
  [http_service.http_options]
    idle_timeout = 600
  [http_service.checks]
    type = "tcp"
    grace_period = "10s"
    interval = "30s"
    timeout = "5s"
    port = 8080

[deploy]
  release_command = "npx prisma migrate deploy"
  strategy = "rolling"
  wait_timeout = "10m"

[[files]]
  guest_path = "/app/prisma/cert.pem"
  local_path = "./prisma/cert.pem"

[[vm]]
  size = "shared-cpu-1x"
  memory = "256mb"
  cpus = 1
  processes = ["app"]

[processes]
  app = "npm run start:prod"