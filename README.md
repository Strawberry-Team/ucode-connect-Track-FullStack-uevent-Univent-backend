<div align="center">
   <p align="center">
      <a href="https://ucode.world/en/" target="_blank">
         <img src="https://github.com/Strawberry-Team/ucode-connect-Track-FullStack-uevent-Univent-backend/blob/main/public/project/ucode_it_academy_logo.svg" height="100px" alt="ucode_logo">
      </a>
   </p>

   <img src="./public/project/1-logo.png" width="200" />
   <h1 align="center">Univent</h1>

<p align="center">
   <img src="https://img.shields.io/badge/TypeScript-3178C6?logo=typescript&logoColor=white" alt="TypeScript" />
   <img src="https://img.shields.io/badge/Node.js-339933?logo=nodedotjs&logoColor=white" alt="Node.js" />
   <img src="https://img.shields.io/badge/NestJS-E0234E?logo=nestjs&logoColor=white" alt="NestJS" />
   <img src="https://img.shields.io/badge/Express-000000?logo=express&logoColor=white" alt="Express" />
   <img src="https://img.shields.io/badge/MySQL-4479A1?logo=mysql&logoColor=white" alt="MySQL" />
   <img src="https://img.shields.io/badge/Prisma-2D3748?logo=prisma&logoColor=white" alt="Prisma" />
   <img src="https://img.shields.io/badge/Swagger-85EA2D?logo=swagger&logoColor=white" alt="Swagger" />
   <img src="https://img.shields.io/badge/Docker-2496ED?logo=docker&logoColor=white" alt="Docker" />
   <img src="https://img.shields.io/badge/Jest-C21325?logo=jest&logoColor=white" alt="Jest" />
   <img src="https://img.shields.io/badge/Faker.js-1565C0?logo=faker&logoColor=white" alt="Faker.js" />
   <img src="https://img.shields.io/badge/Stripe-008CDD?logo=stripe&logoColor=white" alt="Stripe" />
   <img src="https://img.shields.io/badge/Google_Maps-4285F4?logo=google-maps&logoColor=white" alt="Google Maps" />
   <img src="https://img.shields.io/badge/Unsplash-000000?logo=unsplash&logoColor=white" alt="Unsplash" />
   <img src="https://img.shields.io/badge/JWT-000000?logo=json-web-token&logoColor=white" alt="JSON Web Token" />
   <img src="https://img.shields.io/badge/Bcrypt-003087?logo=bcrypt&logoColor=white" alt="Bcrypt" />
   <img src="https://img.shields.io/badge/Passport-34E27A?logo=passport&logoColor=white" alt="Passport" />
   <img src="https://img.shields.io/badge/class_validator-FF6F61?logo=class-validator&logoColor=white" alt="class-validator" />
   <img src="https://img.shields.io/badge/class_transformer-FF6F61?logo=class-transformer&logoColor=white" alt="class-transformer" />
   <img src="https://img.shields.io/badge/Nodemailer-0095FF?logo=nodemailer&logoColor=white" alt="Nodemailer" />
   <img src="https://img.shields.io/badge/cookie_parser-000000?logo=cookiecutter&logoColor=white" alt="cookie-parser" />
   <img src="https://img.shields.io/badge/csurf-000000?logo=csurf&logoColor=white" alt="csurf" />
   <img src="https://img.shields.io/badge/Multer-2C3E50?logo=multer&logoColor=white" alt="Multer" />
   <img src="https://img.shields.io/badge/Date_fns-B22222?logo=date-fns&logoColor=white" alt="Date-fns" />
   <img src="https://img.shields.io/badge/ESLint-4B32C3?logo=eslint&logoColor=white" alt="ESLint" />
   <img src="https://img.shields.io/badge/Prettier-F7B93E?logo=prettier&logoColor=black" alt="Prettier" />
   <img src="https://img.shields.io/badge/Axios-5A29E4?logo=axios&logoColor=white" alt="Axios" />
</p>

   <h3>
      <p align="center">
         <sub><i>
            ucode connect uevent "Univent" is the project of ucode connect the Track FullStack programming bootcamp<br />
            lasting 5 weeks (March 31, 2025 - May 2, 2025),<br />where the NestJS with TypeScript and React with Next.js were used to develop the event ticketing service.<br /><br />
            The purpose: create an event ticketing service to unite people with the same interests<br />using the whole cycle of Challenge Based Learning framework with a team.
         </i></sub>
      </p>
   </h3>
</div>



# 🗓️ Overview
<b>Univent</b> is a platform for creating, attending and managing events! 

Organise events with interactive maps, buy tickets, use promo codes and receive notifications. 

A user-friendly profile for everyone - from organisers to guests.



# 🧑‍💻 Team
<div>
    <table width="100%" border="0" cellpadding="1" align="center">  
        <tr>
            <td align="center">
                <a href="https://github.com/InessaRepeshko">
                    <img src="https://avatars.githubusercontent.com/u/80609514?v=4?s=100" width="150px;" alt="Inessa Repeshko"/><br />
                    <sub><b>Inessa Repeshko</b></sub>
                </a><br />
            </td>
            <td align="center">
                <a href="https://github.com/laskevych">
                    <img src="https://avatars.githubusercontent.com/u/29709878?v=4?s=100" width="150px;" alt="Andrew Laskevych"/><br />
                    <sub><b>Andrew Laskevych</b></sub>
                </a><br />
            </td>
            <td align="center">
                <a href="https://github.com/Kolesnichenko0">
                     <img src="https://avatars.githubusercontent.com/u/99329524?v=4?s=100" width="150px;" alt="Denis Kolesnichenko"/><br />
                     <sub><b>Denis Kolesnichenko</b></sub>
                </a><br />
            </td>
            <td align="center">
                <a href="https://github.com/Machinato">
                    <img src="https://avatars.githubusercontent.com/u/119456377?v=4?s=100" width="150px;" alt="Maksym Hrytsenko"/><br />
                    <sub><b>Maksym Hrytsenko</b></sub>
                </a><br />
            </td>
        </tr>
    </table>
</div><br />



# 🗓 About "Univent" platform
Univent is a dynamic ticketing platform designed to simplify event management and ticketing. 

The Univent backend built on Node.js, NestJS, Express, and Prisma with MySQL, provides secure event, ticket, and payment management via Stripe, integration with Google API and Unsplash, authentication with JWT, Bcrypt, and Passport, as well as automation with PDFKit, QRCode, scheduling with @nestjs/schedule, documentation with Swagger, containerisation with Docker, and testing with Jest, Faker.js, ESLint, and Prettier.

Here is a [link](https://docs.google.com/presentation/d/1sdtH8O495crk_I2gUyWO1z9XUWx4i6cH/edit?usp=sharing&ouid=109902939512595211399&rtpof=true&sd=true) to the presentation file.</p>

![CleanShot 2025-06-20 at 19 42 38](https://github.com/user-attachments/assets/bbef933a-aff0-4612-a0fa-c3734263a027)
![CleanShot 2025-06-20 at 19 36 33](https://github.com/user-attachments/assets/8a7ca803-97f9-4dc4-a509-0609296614ac)
![CleanShot 2025-06-20 at 19 36 37](https://github.com/user-attachments/assets/cd5f8352-8896-4a96-8488-c747902ff0c7)
![CleanShot 2025-06-20 at 19 36 42](https://github.com/user-attachments/assets/cbd9ebe4-e325-4fed-9b36-4b0ec51e1ff6)



# 🎯 Features and Functionality
**Univent** is a comprehensive event management platform that provides the following features:

### 🔐 Authentication & Authorization
- User Registration & Login with email verification
- Google OAuth 2.0 integration for social authentication
- JWT-based authentication with access and refresh tokens
- Password reset functionality with secure token validation
- Role-based access control for different user types
- Account email confirmation system

### 👥 User Management
- User profile management with avatar upload support
- Account settings and password management
- User dashboard with personalized content
- Account ownership guards for secure access control

### 🏢 Company Management
- Company registration and profile setup
- Company logo upload and management
- Company profile pages with detailed information
- Company ownership verification and access control
- Company-specific news publishing
- Company deletion with safety checks

### 🎪 Event Management
- Event creation and publishing with detailed metadata
- Event poster upload and management
- Multiple event formats support (conference, workshop, etc.)
- Event themes and categorization system
- Event status management (draft, published, ongoing, finished, cancelled)
- Event venue and location management
- Event scheduling with start and end times
- Ticket sales scheduling with availability windows
- Event attendee management and visibility controls
- Event updates and notifications to subscribers

### 🎫 Ticketing System
- Multiple ticket types per event with different pricing
- Ticket status management (available, reserved, sold, unavailable)
- Unique ticket number generation for each ticket
- PDF ticket generation with QR codes for verification
- Ticket file management and secure download
- Ticket verification system using QR codes

### 💳 Payment Processing
- Stripe payment integration for secure transactions
- Payment intent creation and management
- Multiple payment status tracking (pending, paid, failed, refunded)
- Automatic invoice generation and delivery
- Payment status synchronization with Stripe
- Refund handling and status updates

### 🛒 Order Management
- Shopping cart functionality for multiple tickets
- Order creation with item management
- Order status tracking throughout the purchase process
- Order history and detailed views
- PDF ticket access through secure order links
- Order confirmation emails with ticket attachments

### 🎟️ Promo Codes & Discounts
- Promo code creation with percentage-based discounts
- Event-specific promo codes with validation
- Promo code activation/deactivation controls
- Secure hash-based promo code storage
- Discount calculation and application to orders

### 📧 Email System
- Automated email notifications for various events
- Welcome emails for new users and companies
- Email confirmation for account verification
- Password reset emails with secure links
- Ticket confirmation emails with PDF attachments
- Multiple email themes support
- Gmail API integration for production email delivery
- Ethereal email for development testing

### 🔔 Notification System
- Real-time notifications for event updates
- Event status change notifications to subscribers
- Event date/venue change notifications
- New event announcements for company followers
- News publication notifications
- New attendee notifications for events
- Notification read/hide status management

### 📰 News Management
- Company news creation and publishing
- Event-specific news and announcements
- News editing and deletion by authorized users
- News visibility on company and event pages
- Automatic notifications for news publication

### 📬 Subscription System
- Event subscription for updates and notifications
- Company subscription for following organizations
- Automatic subscription when joining events
- Subscription management and unsubscribe options

### 📊 Event Analytics & Attendees
- Event attendee tracking and management
- Attendee visibility controls (public, attendees-only, private)
- Event aggregation and statistics
- Attendee list management for event organizers

### 🔍 Search & Filtering
- Event search and filtering by various criteria
- Company search and discovery
- Pagination support for large datasets
- Advanced filtering options for events and companies

### 📱 File Management
- Secure file upload for avatars, logos, and posters
- File type validation and size restrictions
- Organized file storage with proper directory structure
- Default placeholder images for entities

### 🏗️ Background Jobs & Scheduling
- JWT token cleanup scheduler
- User notification processing scheduler
- Automated background tasks for system maintenance

### 🛡️ Security Features
- CSRF protection with custom filters
- Request validation with comprehensive validators
- Input sanitization and type checking
- Secure password hashing using bcrypt
- Rate limiting and security headers
- Environment-based configuration management

### 🔧 API Documentation
- Comprehensive Swagger documentation for all endpoints
- Interactive API explorer at `/api` endpoint
- Detailed request/response schemas
- API versioning and security documentation

### 🧪 Testing Infrastructure
- Unit testing for all services and controllers
- End-to-end testing for complete user workflows
- Fake data generation for testing purposes
- Test database setup and teardown



# 👤 Use case diagram
![Use_Case_Diagram](https://github.com/user-attachments/assets/c76bdd6a-f6c9-4b03-a890-68352e111192)



# 🧲 Activity diagram
![Activity_Diagram](https://github.com/user-attachments/assets/bfa1fa4b-6c35-47ac-b969-91f634eee187)



# 🚚 Deployment Diagram
![Deployment_Diagram](https://github.com/user-attachments/assets/2b6e080a-945d-454c-830a-3def71c9db86)



# 🤓 Database Diagram
![Database Diagram](https://github.com/user-attachments/assets/aa1a79cf-f73b-4d00-b0cd-6c9e6d17829f)



# ⚙️ Requirements and Dependencies

Before starting, ensure the required technologies are installed.

- **Node.JS** >= v22
- **NPM** >= v10
- **MySQL** >= 8.0

# 🚀 How to Run the Solution

In the examples of all commands in the text `<env>` is the name of the environment to perform the migration, e.g. `dev`,
`test` or `prod`.

1. Clone this repository and move to the project directory:
   ```bash
   git clone <repository-url>
   ```
2. Install all dependencies:
   ```bash
   npm install
   ```
3. For development purposes use `dev` environment. Configure the database connection by copying the
   `.env.development.example` to a new file `.env.development`. After that put your MySQL credentials of root user:
    ```
    # Database Root Configuration
    DB_ROOT_HOST=localhost
    DB_ROOT_PORT=3306
    DB_ROOT_USER=root
    DB_ROOT_PASSWORD=root
    ```
   Also, new DB user `uevent_sql` will be created after executing the next command. Credentials of `uevent_sql` user can be changed:
    ```
    # Database App Configuration
    DB_APP_HOST=localhost
    DB_APP_PORT=3306
    DB_APP_USER=univent_sql
    DB_APP_PASSWORD=securepass
    DB_APP_DATABASE=univent
    ```
   For test purposes use `test` environment: create `.env.test` file by copying the `.env.test.example` file.
4. Run script for create databases and user:
   ```bash
   npm run setup:db
   ```
//TODO: подумать, как сделать так, чтобы наименьше надо было выполнять команд
5. Run command to apply necessary migrations.
   ```bash
   npm run migrate
   ```
6. Run command to create prisma client:
   ```bash
   npm run migrate:generate
   ```
7. Run command to build the project:
   ```bash
   npm run build
   ```
8. Seeds help you fill your database with initial data for a presentation or project launch. To start creating test data, run the command:
    ```bash
    npm run migrate:seed
    ```
    or run following command to rewrite data:
    ```bash
    npm run migrate:refresh
    ```
9. Start the server:
    ```bash
    npm run start:dev
    ```
10. Application will be launched on [http://localhost:8080/](http://localhost:8080/).

# 🐋 Docker
Environment variables are taken from `.env.development` file. You can start containers with the command:
```
docker-compose --env-file .env.development up -d
```
To view a list of containers:
```
docker ps -a
```
To stop running containers:
```
docker-compose stop
```
To stop and delete containers, networks, and associated resources (with volumes):
```
docker-compose down -v
```

# 📫 Mailing Service

[Ethereal](https://ethereal.email/) is a fake SMTP service, mostly aimed at Nodemailer and EmailEngine users (but not
limited to). It's a completely free anti-transactional email service where messages never get delivered.
To view the letter that the user will receive, you need to log in to this service using a test login and password.
Default credentials you can find in `.env.development.example` file or:

* login:
    ```text
    ricky43@ethereal.email
    ```
* password:
    ```text
    4e1zbM2nxsMu2d823E
    ```

# 🔁 REST API documentation

The documentation of all available endpoints can be found [http://localhost:8080/api](http://localhost:8080/api).
The [Swagger](https://swagger.io/) library is used.


## 📬 Postman
The [univent.postman_collection.json](/docs/postman/univent.postman_collection.json) file is a preconfigured Postman collection designed to simplify testing and interaction with the Univent API. This collection includes a comprehensive set of API requests organized into logical folders, covering authentication, user management, event handling, subscriptions, payments, notifications, promo codes, orders, and more. By importing this collection into Postman you can quickly set up and execute API calls to explore the Univent API's functionality.

#### Structure of the Collection
The [univent.postman_collection.json](/docs/postman/univent.postman_collection.json) file is organized into several folders, each corresponding to a specific category of API endpoints. Below is an overview of the main folders and their test cases, as shown in the screenshots provided.

![postman_auth](/docs/postman/auth.png)
![postman_users](/docs/postman/users.png)
![postman_companies](/docs/postman/companies.png)
![postman_events](/docs/postman/events.png)
![postman_others](/docs/postman/others.png)

#### Importing the Collection into Postman
Follow these steps to import and set up the Univent Postman collection:

1. Open Postman:
    * Launch the Postman application on your computer.
2. Import the Collection:
    * Click the Import button in the top-left corner of Postman.
    * In the import dialog, select Choose Files and navigate to the `/docs/postman/univent.postman_collection.json` file in your project directory.
    * Alternatively, drag and drop the univent.postman_collection.json file into the import dialog.
    * Click Import to load the collection into Postman.
3. Verify the Collection:
    * Once imported, the "univent" collection will appear in the Collections sidebar on the left.
    * Expand the collection to view the organized folders (e.g., Auth, Users, Companies, Events, etc.), as shown in the screenshots (auth.png, users.png, companies.png, events.png, others.png).
4. Set Up Environment Variables:
![postman_env_variables](/docs/postman/env_variables.png)
    * The collection uses variables like `{{url}}`, `{{csrfToken}}`, `{{accessToken}}`, and `{{refreshToken}}` to dynamically configure requests.
    * Create a new Postman environment or update an existing one:
        * Click the Environments tab in Postman.
        * Create a new environment (e.g., "Univent") or select an existing one.
        * Add the following variables (initial values are provided in the collection's variable section): 
        * url: Set to http://localhost:8080/api (or your API's base URL).
            * `csrfToken`: Initially set to a placeholder (e.g., 8gAKNsET-yxO1S-Qny8PrGewCQ_qnn5yc6qE). This will be updated automatically by the "Get CSRF Token" request.
            * `accessToken`: Placeholder for the JWT access token, updated by the "Login" or "Refresh Access Token" requests.
            * `refreshToken`: Placeholder for the JWT refresh token, updated by the "Login" request.
            * `passwordResetLink` and confirmEmailLink: Optional variables for password reset and email confirmation links.
            * `baseUrl`: Optional variable for additional URL configurations.
        * Save the environment and select it from the environment dropdown in Postman.
5. Test the Collection:
    * Start by running the Get CSRF Token request in the Auth folder. This request retrieves a CSRF token and stores it in the csrfToken variable using a Postman test script.
    * Proceed to the Register or Login requests to authenticate and obtain accessToken and refreshToken values, which are automatically stored by test scripts.
    * Use the authenticated tokens to test other endpoints (e.g., retrieving event subscriptions, creating orders, or validating promo codes).
    * Each request includes example responses in the collection, showing expected status codes (e.g., 200 OK, 201 Created, 422 Unprocessable Entity) and response bodies.


# 📦 Migrations

1. To create new migration run command:
    ```bash
    npm run migrate:create --name <migration_name>
    ```
2. To refresh all data at the database run command:
    ```bash
    npm run migrate:refresh
    ```

# 🪲 Testing

For all commands in the text below, the environment is a `test` that uses the variables of the `.env.test.example` file.

1. Unit tests
    * Run all unit tests with a detailed report:
    ```bash
    npm run test:unit
    ```
    * Run one specific unit test file with a detailed report:
    ```bash
    npm run test:unit -- <file_name>
    ```
2. End-to-end (e2e) testing
    * Run all e2e tests with detailed report:
    ```bash
    npm run test:e2e
    ```
    * Run one specific e2e test file with a detailed report:
    ```bash
    npm run test:e2e -- <file_name>
    ```
3. All testing
    * Run all e2e and unit tests with detailed report:
   ```bash
   npm run test
   ```

# 👤 Fake Data
To fill the database with demo data of users, companies, events and tickets, run the following command:
```bash
npm run migarte:seed
```
Here is the fake data for presentations.

User data for testing:
* full name:
   ```text
   Test User
   ```
* email:
  ```text
  test.user@univent.com
  ```
All users have a password:
```text
Password123!$
```

# 🏞 Unsplash
**Unsplash** is the internet’s source of freely usable images.

To connect to the Unsplash, follow these steps:
1. Sign up for an account with Unsplash:
    Go to (Unsplash Developers)[https://unsplash.com/developers] and sign in to your Unsplash account (or create a new one).
2. Create an app:
    In the `Your Applications` section, click `New Application`.
    Fill in the fields: name of the app (for example, `Event App`), description (for example, `Get images for events`). Accept the terms and conditions.
3. Get the API key:
    After creating the app, you will see the Access Key (and Secret Key if you need OAuth). The Access Key is your API key.
    Copy the key and save it in a safe place, for example, in your `.env` or `.env.development` file:
    ```text
    UNSPLASH_ACCESS_KEY=<access_key>
    ```
4. After put your access key to the `.env.development` file:
    ```bash
    # Upsplash Configuration
    UNSPLASH_ACCESS_KEY=<API_key>
    ```
In Development Mode, you have **50 requests per hour**. To increase the limit (up to 5000 requests/hour), apply for production access via the Unsplash dashboard, providing use cases with attribution.

More information can be found in the [Unsplash documentation](https://unsplash.com/documentation).



© Inessa Repeshko. 2025
